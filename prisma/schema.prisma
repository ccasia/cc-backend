generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @unique @default(cuid())
  googleId String? @unique

  email    String  @unique @db.VarChar(255)
  password String? @db.VarChar(255)

  emailVerificationId String?            @unique
  emailVerifcation    EmailVerification? @relation(fields: [emailVerificationId], references: [id])

  createdAt          DateTime            @default(now())
  name               String?             @db.VarChar(255)
  photoURL           String?             @db.VarChar(255)
  country            String?             @db.VarChar(100)
  city               String?             @db.VarChar(100)
  phoneNumber        String?             @db.VarChar(100)
  updatedAt          DateTime            @updatedAt
  status             Status              @default(pending)
  eventId            String?
  role               RoleEnum
  photoBackgroundURL String?             @db.VarChar(255)
  updateRefershToken DateTime?
  xeroRefreshToken   String?
  admin              Admin?
  client             Client?
  agreementTemplate  AgreementTemplate[]
  Board              Board?
  BookMarkCampaign   BookMarkCampaign[]
  campaignLogs       CampaignLog[]
  CampaignTaskAdmin  CampaignTaskAdmin[]
  creator            Creator?
  creatorAgreement   CreatorAgreement[]
  feedback           Feedback[]
  finance            Finance?
  invoice            Invoice[]           @relation("CreatedBy")
  sentMessages       Message[]           @relation("UserMessages")
  notifications      Notification[]
  paymentForm        PaymentForm?
  pitch              Pitch[]
  approvedPitches    Pitch[]             @relation("ApprovedByClient")
  rejectedPitches    Pitch[]             @relation("RejectedByClient")
  maybePitches       Pitch[]             @relation("MaybeByClient")

  resetPasswordToken ResetPasswordToken?
  seenMessages       SeenMessage[]
  shortlisted        ShortListedCreator[]
  submission         Submission[]
  taskAssignee       TaskAssignee[]
  unreadMessages     UnreadMessage[]
  event              Event?               @relation(fields: [eventId], references: [id])
  userNotification   UserNotification[]
  UserThread         UserThread[]
  threads            Thread[]             @relation("UserThreads")
  bugs               Bugs[]
  video              Video[]
  rawFootage         RawFootage[]
  photo              Photo[]
  isActive           Boolean              @default(true)
  isVerified         Boolean              @default(false)
  isKWSPCampaign     Boolean?             @default(false)
  hasSubmittedKWSP   Boolean              @default(false)

  referralCode String? @db.VarChar(50)

  // Individual feedback relations
  videoFeedback      Video[]      @relation("VideoFeedback")
  rawFootageFeedback RawFootage[] @relation("RawFootageFeedback")
  photoFeedback      Photo[]      @relation("PhotoFeedback")

  // logistics
  assignedLogistics Logistic[]      @relation("AssignedLogistics")
  createdLogistics  Logistic[]      @relation("CreatedLogistics")
  reportedIssues    LogisticIssue[]
}

model EmailVerification {
  id        String   @id @unique @default(cuid())
  shortCode String
  token     String
  expiredAt DateTime
  user      User?
}

model ResetPasswordToken {
  id        String   @id @unique @default(cuid())
  token     String?
  userId    String?  @unique
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
}

model Admin {
  id          String  @id @unique @default(cuid())
  mode        Mode    @default(normal)
  inviteToken String? @unique
  userId      String  @unique
  roleId      String?

  xeroTokenSet Json?

  role Role? @relation(fields: [roleId], references: [id])
  user User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  // Remove client relation since we're separating client and admin
  // client Client?

  adminPermissionModule AdminPermissionModule[]
  campaignAdmin         CampaignAdmin[]
  adminLogs             AdminLog[]              @relation("AdminToAdminLog")
  approvedPitches       Pitch[]                 @relation("ApprovedByAdmin")
  rejectedPitches       Pitch[]                 @relation("RejectedByAdmin")
  adminCommentedPitches Pitch[]                 @relation("AdminCommenter")
  approvedSubmissions   Submission[]            @relation("ApprovedByAdmin")
  submittedSubmissions  Submission[]            @relation("SubmittedByAdmin")
  completedAgreements   CreatorAgreement[]      @relation("CompletedByAdmin")
}

model Client {
  id          String  @id @unique @default(cuid())
  inviteToken String? @unique
  companyId   String?

  // Remove admin sharing - clients should not share admin IDs
  // adminId String? @unique  // ❌ REMOVED
  // admin  Admin? @relation(fields: [adminId], references: [id])  // ❌ REMOVED

  // Keep user relation but with better separation
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Keep company relation
  company Company? @relation(fields: [companyId], references: [id])

  // Add client-specific fields
  clientType ClientType @default(directClient)
  isActive   Boolean    @default(true)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @default(now()) @updatedAt

  isParentAccount Boolean  @default(false)
  parentClientId  String?
  parentClient    Client?  @relation("ParentChildClients", fields: [parentClientId], references: [id])
  childClients    Client[] @relation("ParentChildClients")

  // Client-specific relations
  clientNotifications ClientNotification[]
  campaignClients     CampaignClient[]
  childAccounts       ChildAccount[]
}

// New enum for client types
enum ClientType {
  directClient
  agencyClient
  enterpriseClient
}

enum ClientCampaignRole {
  owner
  viewer
  editor
  approver
}

// Separate client notification model
model ClientNotification {
  id        String   @id @unique @default(cuid())
  clientId  String
  title     String
  message   String
  entity    Entity?
  entityId  String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model ChildAccount {
  id          String    @id @unique @default(cuid())
  email       String
  password    String?
  firstName   String?
  lastName    String?
  isActive    Boolean   @default(false)
  invitedAt   DateTime  @default(now())
  activatedAt DateTime?

  parentClientId String
  parentClient   Client @relation(fields: [parentClientId], references: [id], onDelete: Cascade)

  invitationToken String?   @unique
  tokenExpiresAt  DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([email, parentClientId])
}

model Role {
  id          String       @id @unique @default(cuid())
  name        String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  admin       Admin[]
  permissions Permisions[] @relation("RolePermission")
}

model Permisions {
  id           String   @id @unique @default(cuid())
  name         String   @unique
  descriptions String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  role         Role[]   @relation("RolePermission")
}

model Creator {
  id                     String      @id @unique @default(cuid())
  pronounce              String?     @db.VarChar(100)
  address                String?
  state                  String?
  city                   String?     @db.VarChar(100)
  postcode               String?     @db.VarChar(20)
  country                String?
  location               String?
  birthDate              DateTime?
  instagram              String?     @db.VarChar(100)
  tiktok                 String?     @db.VarChar(100)
  employment             Employment? @default(others)
  languages              Json?
  userId                 String      @unique
  socialMediaData        Json?
  isFormCompleted        Boolean?
  socialMediaUpdateCount Json?
  allowToChange          Boolean     @default(false)
  industries             Json?
  xeroContactId          String?
  user                   User        @relation(fields: [userId], references: [id])
  interests              Interest[]
  invoices               Invoice[]
  mediaKit               MediaKit?
  isTiktokConnected      Boolean     @default(false)
  isFacebookConnected    Boolean     @default(false)
  tiktokData             Json?
  instagramData          Json?
  isGuest                Boolean     @default(false)

  isOnBoardingFormCompleted Boolean?

  profileLink String? // Profile link for creator (Instagram/TikTok/etc.)

  instagramProfileLink String? @db.VarChar(255)
  tiktokProfileLink    String? @db.VarChar(255)

  tiktokUser          TiktokUser?
  instagramUser       InstagramUser?
  dietaryRestrictions String?

  // Credit Tier fields
  manualFollowerCount Int?         @default(0) // Manually entered follower count (when no media kit)
  creditTierId        String?
  creditTier          CreditTier?  @relation("UserCurrentTier", fields: [creditTierId], references: [id])
  tierUpdatedAt       DateTime?    // Last time tier was calculated
}

// model TiktokUser {
//   id String @id @unique @default(cuid())

//   creatorId String  @unique
//   creator   Creator @relation(references: [id], fields: [creatorId])

//   display_name String?
//   avatar_url   String?

//   following_count Int?
//   follower_count  Int?
//   likes_count     Int?

//   averageComments Int?
//   averageLikes    Int?
//   engagement_rate

//   createdAt   DateTime      @default(now())
//   updatedAt   DateTime      @updatedAt
//   tiktokVideo TiktokVideo[]
// }

model TiktokUser {
  id String @id @unique @default(cuid())

  creatorId String  @unique
  creator   Creator @relation(references: [id], fields: [creatorId])

  display_name String?
  username     String?
  avatar_url   String?

  following_count Int?
  follower_count  Int?
  likes_count     Int?

  totalLikes      Int?
  totalComments   Int?
  totalShares     Int?
  averageLikes    Float?
  averageComments Float?
  averageShares   Float?
  engagement_rate Float?
  lastUpdated     DateTime?

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  tiktokVideo TiktokVideo[]
}

model TiktokVideo {
  id              String  @id @unique @default(cuid())
  video_id        String? @unique
  cover_image_url String?
  title           String?
  description     String?
  duration        Float?
  embed_link      String?
  embed_html      String?

  like_count    Int?
  comment_count Int?
  share_count   Int?
  view_count    Int?

  tiktokUserId String?
  tiktokUser   TiktokUser? @relation(references: [id], fields: [tiktokUserId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InstagramUser {
  id String @id @unique @default(cuid())

  creatorId String  @unique
  creator   Creator @relation(references: [id], fields: [creatorId])

  accessToken     Json?
  expiresIn       Int?
  user_id         String?   @unique
  followers_count Int?
  follows_count   Int?
  media_count     Int?
  username        String?
  totalLikes      Int?
  totalComments   Int?
  averageLikes    Float?
  averageComments Float?
  engagement_rate Float?
  lastUpdated     DateTime?

  instagramVideo InstagramVideo[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InstagramVideo {
  id String @id @unique @default(cuid())

  video_id String? @unique

  comments_count Int?
  like_count     Int?
  media_type     String?
  media_url      String?
  thumbnail_url  String?
  caption        String?
  permalink      String?
  shortCode      String?
  datePosted     DateTime?

  instagramUserId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  instagramUser InstagramUser? @relation(fields: [instagramUserId], references: [id])
}

model MediaKit {
  id          String  @id @unique @default(cuid())
  displayName String?

  about String?

  creatorId String  @unique
  creator   Creator @relation(fields: [creatorId], references: [id], onDelete: Cascade)
}

model Message {
  id             Int             @id @default(autoincrement())
  content        String
  createdAt      DateTime        @default(now())
  threadId       String?
  senderId       String?
  file           String?
  fileType       String?
  sender         User?           @relation("UserMessages", fields: [senderId], references: [id])
  thread         Thread?         @relation(fields: [threadId], references: [id])
  seenMessages   SeenMessage[]
  threadLatest   Thread?         @relation("LatestMessage")
  unreadMessages UnreadMessage[]
}

model UnreadMessage {
  id        Int     @id @default(autoincrement())
  userId    String
  threadId  String
  messageId Int
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  thread    Thread  @relation(fields: [threadId], references: [id])
  user      User    @relation(fields: [userId], references: [id])

  @@unique([userId, threadId, messageId])
}

model SeenMessage {
  id        Int     @id @default(autoincrement())
  userId    String
  messageId Int
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id])

  @@unique([userId, messageId])
}

model Thread {
  id              String          @id @unique @default(cuid())
  title           String
  description     String
  photoURL        String?         @db.VarChar(255)
  isGroup         Boolean         @default(true)
  campaignId      String?         @unique
  latestMessageId Int?            @unique
  messages        Message[]
  campaign        Campaign?       @relation(fields: [campaignId], references: [id])
  latestMessage   Message?        @relation("LatestMessage", fields: [latestMessageId], references: [id])
  unreadMessages  UnreadMessage[]
  UserThread      UserThread[]
  users           User[]          @relation("UserThreads")
}

model UserThread {
  userId   String
  threadId String
  archived Boolean @default(false)
  thread   Thread  @relation(fields: [threadId], references: [id])
  user     User    @relation(fields: [userId], references: [id])

  @@id([userId, threadId])
}

model Interest {
  id      String  @id @unique @default(cuid())
  name    String?
  rank    Int?
  userId  String
  creator Creator @relation(fields: [userId], references: [userId], onDelete: Cascade)
}

model Finance {
  id     String @id @unique @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])
}

model Event {
  id          String     @id @unique @default(cuid())
  title       String?
  description String?
  color       String?
  allDay      Boolean
  userId      String
  start       DateTime
  end         DateTime
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  Campaign    Campaign[]
  user        User[]
}

// model session {
//   sid    String   @id @unique @default(cuid())
//   sess   Json
//   expire DateTime
// }

model Session {
  id        String   @id
  sid       String   @unique
  data      String
  expiresAt DateTime
}

model Company {
  // id                  String         @id @unique @default(cuid())
  id                  String       @id @unique @default(cuid())
  name                String
  email               String?
  // clientId            String?        @unique @default(cuid())
  clientId            String?      @unique @default(cuid())
  type                CompanyType?
  phone               String?
  website             String?
  address             String?
  logo                String?
  about               String?
  objectives          Json?
  registration_number String?      @db.VarChar(150)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  brand         Brand[]
  campaign      Campaign[]
  pic           Pic[]
  subscriptions Subscription[]
  clients       Client[]

  @@index([clientId])
}

enum CompanyType {
  agency
  directClient
}

model Pic {
  id          String   @id @unique @default(cuid())
  name        String
  email       String?
  designation String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company? @relation(fields: [companyId], references: [id])
  companyId   String?
  brand       Brand?   @relation(fields: [brandId], references: [id])
  brandId     String?
}

model Brand {
  id           String     @id @unique @default(cuid())
  name         String     @db.VarChar(100)
  email        String?    @db.VarChar(255)
  phone        String?    @db.VarChar(255)
  website      String?    @db.VarChar(255)
  logo         String?    @db.VarChar(255)
  description  String?    @db.VarChar(255)
  service_name String?    @db.VarChar(255)
  instagram    String?    @db.VarChar(255)
  tiktok       String?    @db.VarChar(255)
  facebook     String?    @db.VarChar(255)
  objectives   Json?
  industries   Json?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  companyId    String
  company      Company    @relation(fields: [companyId], references: [id])
  campaign     Campaign[]
  supBrand     SupBrand[]
  pic          Pic[]
}

model SupBrand {
  id                  String        @id @unique @default(cuid())
  name                String        @db.VarChar(255)
  email               String?       @db.VarChar(255)
  phone               String?       @db.VarChar(255)
  tiktok              String?       @db.VarChar(255)
  instagram           String?       @db.VarChar(255)
  website             String?       @db.VarChar(255)
  logo                String?       @db.VarChar(255)
  registration_number String        @unique
  description         String?       @db.VarChar(255)
  service_name        String?       @db.VarChar(255)
  facebook            String?       @db.VarChar(255)
  intersets           Json?
  industries          Json?
  objectives          Json?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  brandId             String
  brand               Brand         @relation(fields: [brandId], references: [id])
  supSupBrand         SupSupBrand[]
}

model SupSupBrand {
  id                  String   @id @unique @default(cuid())
  name                String   @db.VarChar(255)
  email               String?  @db.VarChar(255)
  phone               String?  @db.VarChar(255)
  tiktok              String?  @db.VarChar(255)
  instagram           String?  @db.VarChar(255)
  facebook            String?  @db.VarChar(255)
  website             String?  @db.VarChar(255)
  service_name        String?  @db.VarChar(255)
  registration_number String   @unique
  logo                String?  @db.VarChar(255)
  description         String?  @db.VarChar(255)
  objectives          Json?
  intersets           Json?
  industries          Json?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  supBrandId          String
  supBrand            SupBrand @relation(fields: [supBrandId], references: [id])
}

model Campaign {
  id          String         @id @unique @default(cuid())
  campaignId  String?
  name        String
  description String
  status      CampaignStatus @default(SCHEDULED)

  campaignCredits Int?
  creditsPending  Int?
  creditsUtilized Int?

  brandId        String?
  subscriptionId String?

  companyId           String?
  brandTone           String?
  brandAbout          String?
  productName         String?
  websiteLink         String?
  eventId             String?
  agreementTemplateId String?
  spreadSheetURL      String?
  campaignType        String?            @default("normal")
  origin              CampaignOrigin     @default(ADMIN)
  bookMarkCampaign    BookMarkCampaign[]
  agreementTemplate   AgreementTemplate? @relation(fields: [agreementTemplateId], references: [id])
  brand               Brand?             @relation(fields: [brandId], references: [id])
  company             Company?           @relation(fields: [companyId], references: [id])
  event               Event?             @relation(fields: [eventId], references: [id])
  subscription        Subscription?      @relation(fields: [subscriptionId], references: [id])

  campaignAdmin                 CampaignAdmin[]
  campaignClients               CampaignClient[]
  campaignBrief                 CampaignBrief?
  campaignAdditionalDetails     CampaignAdditionalDetails?
  campaignLogs                  CampaignLog[]
  campaignRequirement           CampaignRequirement?
  campaignSubmissionRequirement CampaignSubmissionRequirement[]
  campaignTasks                 CampaignTask[]
  campaignTimeline              CampaignTimeline[]
  creatorAgreement              CreatorAgreement[]
  invoice                       Invoice[]
  logistics                     Logistic[]
  logisticsType                 LogisticType?
  notifications                 Notification[]
  pitch                         Pitch[]
  shortlisted                   ShortListedCreator[]
  submission                    Submission[]
  thread                        Thread?
  publicAccess                  PublicAccess[]
  products                      Product[]
  reservationConfig             ReservationConfiguration?

  rawFootage   Boolean @default(false)
  photos       Boolean @default(false)
  ads          Boolean @default(false)
  crossPosting Boolean @default(false)

  rawFootages RawFootage[]
  photosData  Photo[]
  video       Video[]

  isKWSPCampaign Boolean? @default(false)

  // Credit Tiering: When true, creator costs based on follower tier instead of flat 1 credit/video
  isCreditTier Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // V4 submission version tracking
  submissionVersion String? @default("v3") // "v2", "v3", "v4"

  // Trends analysis
  submissionPostingUrls  SubmissionPostingUrl[]
  insightSnapshots       InsightSnapshot[]
  manualCreatorEntries   ManualCreatorEntry[]
  
  // PCR (Post Campaign Report)
  pcr CampaignPCR?
}

model BookMarkCampaign {
  id         String   @id @unique @default(cuid())
  userId     String
  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, campaignId])
}

// Separate admin and client campaign access models
model CampaignAdmin {
  adminId    String
  campaignId String
  role       CampaignAdminRole @default(viewer)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @default(now()) @updatedAt

  admin    Admin    @relation(fields: [adminId], references: [userId], onDelete: Cascade)
  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@id([adminId, campaignId])
  @@index([adminId])
  @@index([campaignId])
}

enum CampaignAdminRole {
  owner
  viewer
  editor
  manager
}

// Separate client campaign access model
model CampaignClient {
  clientId   String
  campaignId String
  role       ClientCampaignRole @default(viewer)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @default(now()) @updatedAt

  client   Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@id([clientId, campaignId])
  @@index([clientId])
  @@index([campaignId])
}

model CampaignRequirement {
  id              String   @id @unique @default(cuid())
  // Primary Audience
  gender          String[]
  age             String[]
  geoLocation     String[]
  language        String[]
  creator_persona String[]
  country         String?
  countries       String[]
  user_persona    String
  // Secondary Audience
  secondary_gender          String[]
  secondary_age             String[]
  secondary_geoLocation     String[]
  secondary_language        String[]
  secondary_creator_persona String[]
  secondary_country         String?
  secondary_user_persona    String?
  geographic_focus          String?
  geographicFocusOthers     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  campaignId      String   @unique
  campaign        Campaign @relation(fields: [campaignId], references: [id])
}

model CampaignBrief {
  id                   String    @id @unique @default(cuid())
  title                String
  objectives           String?
  secondaryObjectives  String[]
  boostContent         String?
  primaryKPI           String?
  performanceBaseline  String?
  images               Json?
  agreementFrom        String?
  startDate            DateTime
  endDate              DateTime
  postingStartDate     DateTime?
  postingEndDate       DateTime?
  interests            Json?
  industries           String?
  success              String?
  socialMediaPlatform  String[]
  videoAngle           String[]
  campaigns_do         Json?
  campaigns_dont       Json?
  updatedAt            DateTime  @updatedAt
  createdAt            DateTime  @default(now())
  campaignId           String    @unique
  otherAttachments     String[]
  referencesLinks      String[]
  campaign             Campaign  @relation(fields: [campaignId], references: [id])
}

model CampaignAdditionalDetails {
  id                        String    @id @unique @default(cuid())
  contentFormat             String[]
  mainMessage               String?
  keyPoints                 String?
  toneAndStyle              String?
  brandGuidelinesUrl        String?
  referenceContent          String?
  productImage1Url          String?
  productImage2Url          String?
  // Additional Details 2 fields
  hashtagsToUse             String?
  mentionsTagsRequired      String?
  creatorCompensation       String?
  ctaDesiredAction          String?
  ctaLinkUrl                String?
  ctaPromoCode              String?
  ctaLinkInBioRequirements  String?
  specialNotesInstructions  String?
  needAds                   String?
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
  campaignId                String    @unique
  campaign                  Campaign  @relation(fields: [campaignId], references: [id])
}

model Permission {
  id                    String                  @id @unique @default(cuid())
  description           String?
  name                  String
  adminPermissionModule AdminPermissionModule[]
}

model Module {
  id                    String                  @id @unique @default(cuid())
  name                  Modules
  description           String?
  adminPermissionModule AdminPermissionModule[]
}

model AdminPermissionModule {
  id           String     @id @unique @default(cuid())
  adminId      String
  moduleId     String
  permissionId String
  admin        Admin      @relation(fields: [adminId], references: [id])
  module       Module     @relation(fields: [moduleId], references: [id])
  permission   Permission @relation(fields: [permissionId], references: [id])
}

model TimelineDefault {
  id                    String              @id @unique @default(cuid())
  timelineTypeDefaultId String              @unique
  for                   String?
  duration              Int
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  order                 Int
  timelineType          TimelineTypeDefault @relation(fields: [timelineTypeDefaultId], references: [id])
}

model TimelineTypeDefault {
  id              String           @id @unique @default(cuid())
  name            String           @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  timelineDefault TimelineDefault?
}

model CampaignTimeline {
  id               String          @id @unique @default(cuid())
  name             String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  for              String?
  description      String?
  duration         Int
  startDate        DateTime
  endDate          DateTime
  campaignId       String
  order            Int
  status           TimelineStatus  @default(OPEN)
  submissionTypeId String?
  campaignTasks    CampaignTask[]
  campaign         Campaign        @relation(fields: [campaignId], references: [id])
  submissionType   SubmissionType? @relation(fields: [submissionTypeId], references: [id])
}

model CampaignLog {
  id         String   @id @unique @default(cuid())
  createdAt  DateTime @default(now())
  message    String
  campaignId String
  adminId    String
  admin      User     @relation(fields: [adminId], references: [id])
  campaign   Campaign @relation(fields: [campaignId], references: [id])
}

model AdminLog {
  id          String   @id @unique @default(cuid())
  createdAt   DateTime @default(now())
  message     String
  performedBy String?
  adminId     String? // Nullable for past actions
  admin       Admin?   @relation("AdminToAdminLog", fields: [adminId], references: [userId], onDelete: Cascade)
}

model Pitch {
  id                  String         @id @unique @default(cuid())
  type                PitchType
  campaignId          String
  userId              String
  status              PitchStatus?   @default(pending)
  content             String         @default("test")
  createdAt           DateTime       @default(now())
  completedAt         DateTime?
  approvedByAdminId   String?
  approvedByClientId  String?
  rejectedByAdminId   String?
  rejectedByClientId  String?
  rejectionReason     String?
  customRejectionText String?
  maybeByClientId     String?
  amount              Int?
  ugcCredits          Int?
  agreementTemplateId String?
  Notification        Notification[]
  followerCount       String?
  engagementRate      String?
  adminComments       String?
  adminCommentedBy    String?
  adminCommenter      Admin?         @relation("AdminCommenter", fields: [adminCommentedBy], references: [userId])

  // Outreach status tracking
  outreachStatus      OutreachStatus?
  outreachUpdatedAt   DateTime?
  outreachUpdatedBy   String?

  campaign            Campaign       @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user                User           @relation(fields: [userId], references: [id])
  admin               Admin?         @relation(fields: [approvedByAdminId], references: [userId], name: "ApprovedByAdmin")
  client              User?          @relation("ApprovedByClient", fields: [approvedByClientId], references: [id])
  rejectedByAdmin     Admin?         @relation("RejectedByAdmin", fields: [rejectedByAdminId], references: [userId])
  rejectedByClient    User?          @relation("RejectedByClient", fields: [rejectedByClientId], references: [id])
  maybeByClient       User?          @relation("MaybeByClient", fields: [maybeByClientId], references: [id])

  @@unique([userId, campaignId])
}

model ShortListedCreator {
  id               String   @id @default(cuid())
  campaignId       String
  userId           String?
  adminComments    String?
  currency         String?
  shortlisted_date DateTime @default(now())
  isAgreementReady Boolean? @default(false)
  isCampaignDone   Boolean? @default(false)
  isCreatorPaid    Boolean? @default(false)
  ugcVideos        Int?
  amount           Int?
  campaign         Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user             User?    @relation(fields: [userId], references: [id])

  // Credit Tier snapshot at assignment time (for tier campaigns)
  creditPerVideo Int?        // Credits per video at time of assignment
  creditTierId   String?     // Tier ID at time of assignment (snapshot)
  creditTier     CreditTier? @relation(fields: [creditTierId], references: [id])

  @@unique([userId, campaignId])
  @@index([userId])
}

model CampaignTask {
  id                 String              @id @unique @default(cuid())
  task               String?
  campaignTimelineId String
  campaignId         String
  status             TaskStatus          @default(NOT_STARTED)
  createdAt          DateTime            @default(now())
  updatedAd          DateTime            @updatedAt
  dueDate            DateTime?
  campaign           Campaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  timeline           CampaignTimeline    @relation(fields: [campaignTimelineId], references: [id], onDelete: Cascade)
  campaignTaskAdmin  CampaignTaskAdmin[]
}

model CampaignTaskAdmin {
  id             String       @id @default(cuid())
  userId         String
  campaignTaskId String
  campaignTask   CampaignTask @relation(fields: [campaignTaskId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, campaignTaskId])
}

model Notification {
  id               String             @id @unique @default(cuid())
  title            String?
  message          String
  createdAt        DateTime           @default(now())
  entity           Entity?
  campaignId       String?
  pitchId          String?
  submissionId     String?
  creatorId        String?
  userId           String?
  threadId         String?
  invoiceId        String?
  campaign         Campaign?          @relation(fields: [campaignId], references: [id])
  pitch            Pitch?             @relation(fields: [pitchId], references: [id])
  submission       Submission?        @relation(fields: [submissionId], references: [id])
  User             User?              @relation(fields: [userId], references: [id])
  userNotification UserNotification[]
}

model UserNotification {
  id             String       @id @unique @default(cuid())
  userId         String
  notificationId String
  read           Boolean      @default(false)
  archive        Boolean      @default(false)
  readAt         DateTime?
  notification   Notification @relation(fields: [notificationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@unique([userId, notificationId])
}

model Submission {
  id                   String                 @id @default(cuid())
  content              String?
  caption              String?
  videos               String[]
  campaignId           String
  status               SubmissionStatus       @default(IN_PROGRESS)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  submissionDate       DateTime?
  dueDate              DateTime?
  completedAt          DateTime?
  nextsubmissionDate   DateTime?
  approvedByAdminId    String?
  userId               String
  submissionTypeId     String
  isReview             Boolean                @default(false)
  startDate            DateTime?
  endDate              DateTime?
  submittedByAdminId   String? // Track if admin submitted for creator
  feedback             Feedback[]
  Notification         Notification[]
  campaign             Campaign               @relation(fields: [campaignId], references: [id])
  submissionType       SubmissionType         @relation(fields: [submissionTypeId], references: [id])
  user                 User                   @relation(fields: [userId], references: [id])
  admin                Admin?                 @relation(fields: [approvedByAdminId], references: [userId], name: "ApprovedByAdmin")
  submittedByAdmin     Admin?                 @relation(fields: [submittedByAdminId], references: [userId], name: "SubmittedByAdmin")
  dependencies         SubmissionDependency[] @relation("Dependencies")
  dependentOn          SubmissionDependency[] @relation("DependentOn")
  task                 Task[]
  video                Video[]
  rawFootages          RawFootage[]
  photos               Photo[]
  publicFeedback       PublicFeedback[]
  photosDriveLink      String?
  rawFootagesDriveLink String?

  // V4 specific fields
  contentOrder      Int? // Order of content (Video 1, Video 2, etc.)
  submissionVersion String?          @default("v2") // "v2", "v3", "v4"
  captionHistory    CaptionHistory[]
  submissionPostingUrls SubmissionPostingUrl[]

  @@unique([userId, campaignId, submissionTypeId, contentOrder])
}

model SubmissionPostingUrl {
  id           String     @id @unique @default(cuid())
  campaignId   String
  campaign     Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  submissionId String
  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  platform     String     // "Instagram" | "TikTok"
  postUrl      String     // Full URL
  postingDate  DateTime?  // When creator posted (null = not posted yet)
  shortCode    String?    // Instagram shortcode
  mediaId      String?    // Instagram media ID or TikTok video ID
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([submissionId, platform, postUrl])
  @@index([submissionId])
  @@index([campaignId, platform, createdAt])
}

model InsightSnapshot {
  id                    String   @id @unique @default(cuid())
  campaignId            String
  campaign              Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  snapshotDate          DateTime
  snapshotType          String   // "daily", "weekly", "monthly"
  dayOfWeek             Int?     // 0 (Sunday) - 6 (Saturday), for weekly snapshots
  platform              String   // "Instagram" | "TikTok" | "All"
  totalPosts            Int
  totalViews            Int      @default(0)
  totalLikes            Int      @default(0)
  totalComments         Int      @default(0)
  totalShares           Int      @default(0)
  totalSaved            Int      @default(0)
  totalReach            Int      @default(0)
  averageEngagementRate Float
  topCreatorsByViews    Json?
  dailyViewDeltas       Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@unique([campaignId, platform, snapshotDate])
  @@index([campaignId, snapshotDate])
  @@index([campaignId, snapshotType])
}

model ManualCreatorEntry {
  id              String   @id @unique @default(cuid())
  campaignId      String
  campaign        Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  creatorName     String
  creatorUsername String
  platform        String   // "Instagram" | "TikTok"
  postUrl         String?

  views           Int      @default(0)
  likes           Int      @default(0)
  shares          Int      @default(0)
  saved           Int?     // Only for Instagram
  engagementRate  Float    @default(0)

  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([campaignId])
}

model Video {
  id           String         @id @default(cuid())
  url          String?
  status       FeedbackStatus @default(PENDING)
  campaignId   String?
  campaign     Campaign?      @relation(fields: [campaignId], references: [id])
  userId       String?
  user         User?          @relation(fields: [userId], references: [id])
  submissionId String?
  submission   Submission?    @relation(fields: [submissionId], references: [id])
  createdAt    DateTime       @default(now())
  updatedAt    DateTime?      @updatedAt

  // Individual feedback fields
  feedback   String? // Individual feedback message
  reasons    String[] // Reasons for changes (if any)
  adminId    String? // Admin who provided feedback
  admin      User?     @relation("VideoFeedback", fields: [adminId], references: [id])
  feedbackAt DateTime? // When feedback was provided

  // Previous video draft URLs
  previousDrafts String[] // Array of previous video URLs
}

model RawFootage {
  id         String         @id @default(cuid())
  url        String
  campaignId String?
  campaign   Campaign?      @relation(fields: [campaignId], references: [id])
  userId     String?
  user       User?          @relation(fields: [userId], references: [id])
  status     FeedbackStatus @default(PENDING)

  submissionId String?
  submission   Submission? @relation(fields: [submissionId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime?   @updatedAt

  // Individual feedback fields
  feedback   String? // Individual feedback message
  reasons    String[] // Reasons for changes (if any)
  adminId    String? // Admin who provided feedback
  admin      User?     @relation("RawFootageFeedback", fields: [adminId], references: [id])
  feedbackAt DateTime? // When feedback was provided
}

model Photo {
  id         String         @id @default(cuid())
  url        String
  campaignId String?
  campaign   Campaign?      @relation(fields: [campaignId], references: [id])
  userId     String?
  user       User?          @relation(fields: [userId], references: [id])
  status     FeedbackStatus @default(PENDING)

  submissionId String?
  submission   Submission? @relation(fields: [submissionId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime?   @updatedAt

  // Individual feedback fields
  feedback   String? // Individual feedback message
  reasons    String[] // Reasons for changes (if any)
  adminId    String? // Admin who provided feedback
  admin      User?     @relation("PhotoFeedback", fields: [adminId], references: [id])
  feedbackAt DateTime? // When feedback was provided
}

// model DeliverableFeedback {
//   id String @id @unique @default(cuid())
// }

enum VideoStatus {
  Uploaded
  Processing
  Published
  Rejected
}

enum FeedbackStatus {
  PENDING
  APPROVED
  REJECTED
  REVISION_REQUESTED
  SENT_TO_CLIENT
  CLIENT_FEEDBACK
}

// model DeliverableFeedback {
//   id String @id @unique @default(cuid())
// }

// enum VideoStatus {
//   Uploaded
//   Processing
//   Published
//   Rejected
// }

// enum FeedbackStatus {
//   PENDING
//   APPROVED
//   REJECTED
//   REVISION_REQUESTED
// }

model SubmissionDependency {
  id                    String      @id @default(cuid())
  submissionId          String?
  dependentSubmissionId String?
  dependentSubmission   Submission? @relation("Dependencies", fields: [dependentSubmissionId], references: [id], onDelete: Cascade)
  submission            Submission? @relation("DependentOn", fields: [submissionId], references: [id], onDelete: Cascade)

  @@unique([submissionId, dependentSubmissionId])
}

model CampaignSubmissionRequirement {
  id               String         @id @default(cuid())
  order            Int
  campaignId       String
  submissionTypeId String
  startDate        DateTime
  endDate          DateTime
  campaign         Campaign       @relation(fields: [campaignId], references: [id])
  submissionType   SubmissionType @relation(fields: [submissionTypeId], references: [id])

  @@unique([campaignId, submissionTypeId])
}

model SubmissionType {
  id               String                          @id @default(cuid())
  type             SubmissionEnum                  @unique
  description      String?
  requirements     CampaignSubmissionRequirement[]
  campaignTimeline CampaignTimeline[]
  submissions      Submission[]
}

model Feedback {
  id                 String        @id @unique @default(cuid())
  content            String?
  rawFootageContent  String?
  photoContent       String?
  type               FeedbackType?
  reasons            String[]
  videosToUpdate     String[]
  rawFootageToUpdate String[]
  photosToUpdate     String[]
  submissionId       String
  adminId            String
  sentToCreator      Boolean       @default(false)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  admin              User          @relation(fields: [adminId], references: [id])
  submission         Submission    @relation(fields: [submissionId], references: [id], onDelete: Cascade)
}

model Invoice {
  id            String        @id @unique @default(cuid())
  invoiceNumber String        @unique
  amount        Float
  status        InvoiceStatus @default(draft)
  task          Json?
  bankAcc       Json?
  invoiceFrom   Json?
  invoiceTo     Json?
  deliverables  Json?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  dueDate       DateTime
  creatorId     String
  campaignId    String
  adminId       String?
  user          User?         @relation("CreatedBy", fields: [adminId], references: [id])
  campaign      Campaign      @relation(fields: [campaignId], references: [id])
  creator       Creator       @relation(fields: [creatorId], references: [userId])
}

// model Logistic {
//   id             String         @id @unique @default(cuid())
//   trackingNumber String
//   itemName       String
//   courier        String
//   status         LogisticStatus @default(Product_is_being_packaged)
//   updateAt       DateTime       @updatedAt
//   createdAt      DateTime       @default(now())
//   userId         String
//   campaignId     String
//   campaign       Campaign       @relation(fields: [campaignId], references: [id])
//   user           User           @relation(fields: [userId], references: [id])
// }

model PaymentForm {
  id                String             @id @unique @default(cuid())
  userId            String             @unique
  icNumber          String?
  bankName          String?
  bankAccountName   String?
  bankAccountNumber String?
  countryOfBank     String?
  bodyMeasurement   String?
  allergies         String[]
  status            PaymentFormStatus? @default(approved)
  reason            String?
  user              User               @relation(fields: [userId], references: [id])
}

model Board {
  id        String    @id @unique @default(cuid())
  name      String
  createdAt DateTime  @default(now())
  userId    String    @unique
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  columns   Columns[]
}

model Columns {
  id        String   @id @unique @default(cuid())
  name      String
  position  Int      @default(autoincrement())
  boardId   String
  createdAt DateTime @default(now())
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  task      Task[]
}

model Task {
  id           String         @id @unique @default(cuid())
  name         String
  description  String?
  status       String?
  position     Int
  priority     String?
  createdAt    DateTime       @default(now())
  dueDate      DateTime?
  labels       String[]
  columnId     String
  submissionId String?
  column       Columns        @relation(fields: [columnId], references: [id], onDelete: Cascade)
  submission   Submission?    @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  assignees    TaskAssignee[]
}

model TaskAssignee {
  id         String   @id @unique @default(cuid())
  assignedAt DateTime @default(now())
  taskId     String
  userId     String
  task       Task     @relation(fields: [taskId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model CreatorAgreement {
  id                String    @id @unique @default(cuid())
  agreementUrl      String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  isSent            Boolean   @default(false)
  amount            String?
  currency          String?
  userId            String
  campaignId        String
  completedAt       DateTime?
  approvedByAdminId String?
  version           Int?      @default(1)
  campaign          Campaign  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  admin             Admin?    @relation(fields: [approvedByAdminId], references: [userId], name: "CompletedByAdmin")

  @@unique([userId, campaignId])
}

model Crawler {
  id                 String   @id @unique @default(cuid())
  followers          Int
  engagement_rate    Int
  avg_likes_per_post Int
  top_contents       Json[]
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model AgreementTemplate {
  id            String     @id @unique @default(cuid())
  url           String?
  adminName     String?
  adminICNumber String?
  signURL       String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  userId        String?
  user          User?      @relation(fields: [userId], references: [id])
  isDefault     Boolean?   @default(false)
  campaign      Campaign[]
}

model Bugs {
  id               String   @id @unique @default(cuid())
  stepsToReproduce String
  attachment       String?
  campaignName     String?
  createdAt        DateTime @default(now())
  userId           String?
  user             User?    @relation(references: [id], fields: [userId])
}

model Subscription {
  id              String             @id @unique @default(cuid())
  subscriptionId  String?            @unique
  companyId       String?
  packageId       String?
  customPackageId String?
  currency        String?
  company         Company?           @relation(references: [id], fields: [companyId])
  creditsUsed     Int
  totalCredits    Int?
  packagePrice    Float?
  status          SubscriptionStatus @default(ACTIVE)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  package         Package?           @relation(fields: [packageId], references: [id])
  customPackage   CustomPackage?     @relation(fields: [customPackageId], references: [id])
  expiredAt       DateTime
  campaign        Campaign[]
}

model CustomPackage {
  id String @id @unique @default(cuid())

  customName           String
  customCredits        Int
  customValidityPeriod Int
  customPrice          Float
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  subscriptions        Subscription[]
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

model Package {
  id             String         @id @unique @default(cuid())
  name           String?
  credits        Int
  validityPeriod Int
  subscriptions  Subscription[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  prices         Price[]
}

model Price {
  id        Int      @id @default(autoincrement())
  packageId String
  package   Package  @relation(fields: [packageId], references: [id])
  currency  String
  amount    Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([packageId, currency]) // Ensure each package has only one price per currency
}

enum PackageType {
  Trail
  Basic
  Essential
  Pro
  Custom
}

enum Currencies {
  MYR
  SGD
}

model PublicAccess {
  id         Int      @id @default(autoincrement())
  campaignId String
  password   String
  expiryDate DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id])
}

model PublicFeedback {
  id           String        @id @unique @default(cuid())
  content      String?
  type         FeedbackType?
  reasons      String[] // Optional field for reasons (if required)
  submissionId String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  submission   Submission    @relation(fields: [submissionId], references: [id], onDelete: Cascade)
}

// enum LogisticStatus {
//   Product_is_being_packaged
//   Proudct_is_at_delivery_warehouse_in_transit
//   Product_is_out_for_delivery
//   Product_has_been_received
// }

enum Designation {
  Finance
  CSM
  BD
  Growth
  CSL
}

enum Modules {
  creator
  campaign
  brand
  metric
  invoice
}

enum Resources {
  creator
  brand
  campaign
}

enum Mode {
  god
  advanced
  normal
}

enum Status {
  active
  pending
  banned
  rejected
  blacklisted
  suspended
  spam
  guest
}

enum InvoiceStatus {
  pending
  paid
  overdue
  draft
  pending_approval
  pending_payment
  approved
  rejected
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
  SCHEDULED
  PENDING_CSM_REVIEW
  PENDING_ADMIN_ACTIVATION
}

enum RoleEnum {
  admin
  creator
  client
  brand
  superadmin
  finance
}

enum Stage {
  publish
  draft
}

enum Employment {
  fulltime
  freelance
  part_time
  student
  in_between
  unemployed
  others
}

enum CampaignTimelineStatus {
  close
  active
}

enum TimelineStatus {
  OPEN
  CLOSED
}

enum PitchType {
  video
  text
  shortlisted
  pitch
}

enum PitchStatus {
  pending
  approved
  rejected
  filtered
  undecided
  draft
  // New simplified flow statuses
  PENDING_REVIEW
  SENT_TO_CLIENT
  APPROVED
  MAYBE
  REJECTED
  AGREEMENT_PENDING
  AGREEMENT_SUBMITTED
  WITHDRAWN
}

// Outreach status for internal admin tracking of creator outreach
enum OutreachStatus {
  OUTREACHED
  DISCUSSING
  CONFIRMED
  REJECTED
  INTERESTED
  FOLLOWED_UP
  UNRESPONSIVE
}

enum DraftStatus {
  Pending
  Submitted
  Request_For_Edit
  Reviewed
  Approved
}

enum TaskStatus {
  NOT_STARTED
  TO_DO
  IN_PROGRESS
  COMPLETED
  OVERDUE
}

enum SubmissionStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  PENDING_REVIEW
  APPROVED
  REJECTED
  ON_HOLD
  OVERDUE
  CHANGES_REQUIRED
  POSTED
  // V3 flow statuses for client-created campaigns
  SENT_TO_CLIENT
  CLIENT_APPROVED
  CLIENT_FEEDBACK
  SENT_TO_ADMIN
  SENT_TO_SUPERADMIN
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum Entity {
  Campaign
  User
  Pitch
  Shortlist
  Timeline
  Feedback
  AdminAgreementForm
  AdminFirstDraft
  AdminFinalDraft
  AdminPosting
  ClientAgreementForm
  ClientFirstDraft
  ClientFinalDraft
  ClientPosting
  AgreementForm
  FirstDraft
  FinalDraft
  Posting
  Draft
  Post
  Logistic
  Invoice
  Metrcis
  Agreement
  Chat
  Live
  Status
  PaymentForm
  Creator
}

enum SubmissionEnum {
  AGREEMENT_FORM
  FIRST_DRAFT
  FINAL_DRAFT
  POSTING
  VIDEO
  PHOTO
  RAW_FOOTAGE
  OTHER
}

enum FeedbackType {
  COMMENT
  REASON
  REQUEST
}

enum pakcageStatus {
  active
  inactive
  expired
}

enum PaymentFormStatus {
  rejected
  approved
}

enum CampaignOrigin {
  ADMIN
  CLIENT
}

model CaptionHistory {
  id           String   @id @default(cuid())
  submissionId String
  caption      String?
  author       String // userId or adminId who wrote this caption
  authorType   String // "creator" or "admin" - who wrote this caption
  createdAt    DateTime @default(now())

  submission Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  @@index([submissionId])
  @@index([createdAt])
}

// logistics enums
enum LogisticType {
  PRODUCT_DELIVERY
  RESERVATION
  // STORE_VISIT
}

enum LogisticStatus {
  // initial status
  NOT_STARTED
  PENDING_ASSIGNMENT
  SCHEDULED

  // delivery specific
  SHIPPED
  DELIVERED
  RECEIVED

  // general completion
  COMPLETED
  ISSUE_REPORTED
  ISSUE_RESOLVED
  CANCELLED
}

enum LogisticIssueStatus {
  OPEN
  RESOLVED
}

enum ReservationMode {
  MANUAL_CONFIRMATION
  AUTO_SCHEDULE
}

enum SlotStatus {
  PROPOSED
  SELECTED
  REJECTED
}

// logistics models

model Product {
  id          String   @id @unique @default(cuid())
  productName String
  description String?
  isArchived Boolean @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  deliveryItems DeliveryItem[]

  @@index([campaignId])
}

model Logistic {
  id        String   @id @unique @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  type   LogisticType
  status LogisticStatus @default(PENDING_ASSIGNMENT)

  shippedAt   DateTime?
  deliveredAt DateTime?
  receivedAt  DateTime?
  completedAt DateTime?

  //relations
  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  creatorId String
  creator   User   @relation("AssignedLogistics", fields: [creatorId], references: [id], onDelete: Cascade)

  createdById String
  createdBy   User   @relation("CreatedLogistics", fields: [createdById], references: [id], onDelete: Cascade)

  deliveryDetails    DeliveryDetails?
  reservationDetails ReservationDetails?
  storeVisitDetails  StoreVisitDetails?

  issues LogisticIssue[]

  @@unique([creatorId, campaignId])
  @@index([campaignId])
  @@index([creatorId])
}

model DeliveryDetails {
  id                   String    @id @unique @default(cuid())
  trackingLink         String?
  address              String?
  expectedDeliveryDate DateTime?
  dietaryRestrictions  String?

  logisticId String   @unique
  logistic   Logistic @relation(fields: [logisticId], references: [id], onDelete: Cascade)

  items DeliveryItem[]

  createdAt   DateTime @default(now())
  isConfirmed Boolean  @default(false)
}

model ReservationDetails {
  id String @id @unique @default(cuid())

  outlet         String?
  pax            Int?
  creatorRemarks String?

  picName       String?
  picContact    String?
  budget        String?
  promoCode     String?
  clientRemarks String?

  logisticId String   @unique
  logistic   Logistic @relation(fields: [logisticId], references: [id], onDelete: Cascade)

  slots ReservationSlot[]
  isConfirmed Boolean  @default(false)
}

model StoreVisitDetails {
  id              String   @id @unique @default(cuid())
  storeName       String
  address         String
  appointmentTime DateTime
  contactPerson   String?
  proofOfVisitUrl String? // URL to the uploaded photo/receipt

  logisticId String   @unique
  logistic   Logistic @relation(fields: [logisticId], references: [id], onDelete: Cascade)
}

model LogisticIssue {
  id         String              @id @unique @default(cuid())
  reason     String
  status     LogisticIssueStatus @default(OPEN)
  createdAt  DateTime            @default(now())
  resolvedAt DateTime?

  resolutionNotes String?

  logisticId String
  logistic   Logistic @relation(fields: [logisticId], references: [id], onDelete: Cascade)

  reportedById String
  reportedBy   User   @relation(fields: [reportedById], references: [id])
}

model DeliveryItem {
  id String @id @unique @default(cuid())

  deliveryDetailsId String
  deliveryDetails   DeliveryDetails @relation(fields: [deliveryDetailsId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  quantity Int @default(1)

  @@unique([deliveryDetailsId, productId])
}

model ReservationConfiguration {
  id String @id @unique @default(cuid())

  campaignId String   @unique
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  mode                  ReservationMode
  locations             Json
  availabilityRules     Json
  clientRemarks         String?
  allowMultipleBookings Boolean         @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ReservationSlot {
  id String @id @unique @default(cuid())

  reservationDetailsId String
  reservationDetails   ReservationDetails @relation(fields: [reservationDetailsId], references: [id], onDelete: Cascade)

  startTime DateTime
  endTime   DateTime

  status SlotStatus @default(PROPOSED)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CampaignPCR {
  id String @id @unique @default(cuid())

  campaignId String   @unique
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  content Json // Stores all editable PCR content as JSON

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Credit Tiering System
model CreditTier {
  id              String   @id @unique @default(cuid())
  name            String   @unique // "Nano A", "Nano B", "Micro A", etc.
  minFollowers    Int      // Minimum follower count (inclusive)
  maxFollowers    Int?     // Maximum follower count (inclusive, null = unlimited)
  creditsPerVideo Int      // Credits cost per video for this tier
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  creators            Creator[]            @relation("UserCurrentTier")
  shortlistedCreators ShortListedCreator[]

  @@index([minFollowers])
}
